      PROGRAM V130
      COMMON /HSTBLK/ JHIST(20), JHISTY(20),JHISTZ(20)
      DATA XLONG/1.0/
C         FIRST TIMING.  THE CLASSICAL METHOD FOR 20000 VECTORS
      CALL CTIME(CT1,T1)
      DO 100 KK= 1, 20000
      CALL RNDDIR(X,Y,Z,XLONG)
  100 CONTINUE
C               TIMING.  THE REJECTION METHOD FOR 20000 VECTORS
      CALL CTIME(CT2,T2)
      DO 120 KK= 1, 20000
      CALL RAN3D(X,Y,Z,XLONG)
  120 CONTINUE
      CALL CTIME(CT3,T3)
      TIME1 = T2-T1
      TIME2 = T3 - T2
      PRINT 1001,TIME1,TIME2
      IF (TIME1 .LT. TIME2)  PRINT 1005
C         TEST THAT THE RESULTING DISTRIBUTIONS ARE UNIFORM
      DO 400 IDO= 1, 3
      CALL VZERO(JHIST,60)
      DO 200 KK= 1, 20000
      CALL RAN3D(X,Y,Z,XLONG)
      IBIN = X*10. + 11.
      JBIN = Y*10. + 11.
      KBIN = Z*10. + 11.
      JHIST (IBIN)= JHIST(IBIN) + 1
      JHISTY(JBIN) = JHISTY(JBIN) + 1
      JHISTZ(KBIN) = JHISTZ(KBIN) + 1
  200 CONTINUE
C         CALCULATE CHISQUARE FROM UNIFORM DISTR. IN X,Y,Z
      DEV = SQRT(1000.)
      CHI2 = 0.
      DO 300 IBIN= 1, 60
      CHI2 = CHI2 +(FLOAT(JHIST(IBIN)-1000)/DEV)**2
  300 CONTINUE
      PRINT 1006
      PRINT 1000, JHIST
      PRINT 1000, JHISTY
      PRINT 1000, JHISTZ
      P = PROB(CHI2,57)
      PRINT 1002, CHI2,P
      IF (P .LT. 0.01)  PRINT 1003
      IF (P .GT. 0.99)  PRINT 1004
  400 CONTINUE
 1000 FORMAT (20I5)
 1001 FORMAT (  38H1  TIMING FOR 20000 RANDOM 3-D VECTORS/  19H   CLASSI
     1CAL METHODF10.4,  25H         REJECTION METHODF10.4,  9H  SECONDS/
     2///)
 1002 FORMAT (  11H0CHISQUARE=F10.4,  15H         PROB.=F10.6/)
 1003 FORMAT (  36H0   TEST FAILED.  CHISQUARE TOO BIG /2X,30(1H*)///)
 1004 FORMAT (  38H0   TEST FAILED.  CHISQUARE TOO SMALL /2X,30(1H*)///)
 1005 FORMAT (  41H0  WARNING.   CLASSICAL METHOD IS FASTER.//)
 1006 FORMAT(/  83H0THE FOLLOWING NUMBERS SHOULD BE AROUND 1000.     THE
     1 CHISQUARE SHOULD BE ABOUT 57./)
      END
      SUBROUTINE RNDDIR(X,Y,Z,XLONG)
      DATA TWOPI/6.283185308/
      Q=-1.
      Z = 2.0*RNDM(Q)-1.0
      PT = SQRT(1.0-Z**2)
      PHI = TWOPI*RNDM(Q)
      X = PT * COS(PHI)
      Y = PT * SIN(PHI)
      RETURN
      END
*EXECUTE
*
*
